---
import Section from "@/components/Section/Section.astro";
import Button from "@/components/Button/Button";
import { getCollection } from "astro:content";

const rawServices = await getCollection("services");
// sort by your new `order` field (default to 0 if missing)
const services = rawServices.sort(
  (a, b) => (a.data.order ?? 0) - (b.data.order ?? 0)
);

const defaultSlug = "/contact";
const baseSecClasses =
  "load fade-in min-h-[50vh] lg:min-h-[65vh] xl:min-h-[90vh] w-full bg-cover bg-center flex justify-center";
const headingClass =
  "text-2xl lg:text-3xl xl:text-4xl font-bold load slide-down font-heading";
const paragraphClass = "max-w-prose text-base lg:text-lg load slide-up";
const serviceContainerClass =
  "flex flex-col items-center justify-center text-center p-8 lg:p-16 text-bg space-y-[var(--spacing-md)]";
const buttonsClass = "load scale-up";
const buttonVariant = "tertiary";
---

<Section sectionClass="p-0 m-0" contentClass="p-0 m-0" childSlotClass="p-0 m-0">
  {services.map((svc, idx) => {
    const verticalPosition =
      idx % 2 === 0
        ? "items-center lg:items-end lg:pb-[var(--spacing-xl)]"
        : "items-center lg:items-start lg:pt-[var(--spacing-xl)]";

    return (
      <div
        key={svc.slug}
        class={`${baseSecClasses} ${verticalPosition}`}
        style={`background-image: url(${svc.data.coverImage.src});`}
      >
        <div class={serviceContainerClass}>
          <h2 class={headingClass}>{svc.data.heading}</h2>
          <p class={paragraphClass}>{svc.data.description}</p>
          <Button
            href={svc.data.hasPage ? `/services/${svc.slug}` : defaultSlug}
            variant={buttonVariant}
            className={buttonsClass}
          >
            {svc.data.hasPage ? "Learn More" : "Contact Us"}
          </Button>
        </div>
      </div>
    );
  })}
</Section>
