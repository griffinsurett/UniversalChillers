---
import ItemsTemplate from "@/components/Section/ItemsTemplates/ItemsTemplate.astro";
import MenuItem      from "./MenuItem.astro";
import DefaultSubmenu from "./Submenu.astro";

const {
  collection    = "menuItems",
  query         = "relatedItem:menus:mainMenu",
  itemsClass    = "flex gap-[var(--spacing-md)]",
  sortOrder     = "asc",
  HasPage       = false,

  /* â€”â€”â€”â€”â€”â€”â€”â€”â€” Firstâ€‘level config â€”â€”â€”â€”â€”â€”â€”â€”â€” */
  menuItem = {
    component: MenuItem,
    props: {
      itemClass:    "",
      linkClass:    "",
      hierarchical: false,
    },
  },

  /* â€”â€”â€”â€”â€”â€” Everything about submenus â€”â€”â€”â€”â€”â€” */
  submenu = null, // if null â‡¢ default below
} = Astro.props;

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
/* Build a â€œfinalSubmenuâ€ if caller omitted it */
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let finalSubmenu = submenu;
if (!finalSubmenu) {
  finalSubmenu = {
    /* 1) which component to render for any submenu? */
    component: DefaultSubmenu,

    /* 2) classes for that <ul> (wrapper) */
    itemsClass:
      "submenu absolute left-0 top-full w-40 bg-white shadow-lg opacity-0 pointer-events-none transition-opacity duration-200 ease-in-out z-[100]",

    /* 3) how each nested <MenuItem> looks/behaves */
    subMenuItem: {
      component: menuItem.component,
      props:     { ...menuItem.props },
    },
  };
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
/* Build the props that topâ€‘level <MenuItem> will receive */
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const menuItemProps = {
  ...menuItem.props,
  submenu: finalSubmenu,
};
---

<nav>
  <!-- ğŸ“± Mobile version (stacked) -->
  <div class="block md:hidden">
    <ItemsTemplate
      collection={collection}
      query={query}
      sortOrder={sortOrder}
      HasPage={HasPage}
      itemsClass="flex flex-col space-y-[var(--spacing-sm)]"
      ItemComponent={{
        component: menuItem.component,
        props:      menuItemProps,
      }}
    />
  </div>

  <!-- ğŸ–¥ Desktop version -->
  <div class={itemsClass}>
    <ItemsTemplate
      collection={collection}
      query={query}
      sortOrder={sortOrder}
      HasPage={HasPage}
      itemsClass={itemsClass}
      ItemComponent={{
        component: menuItem.component,
        props:      menuItemProps,
      }}
    />
  </div>
</nav>
